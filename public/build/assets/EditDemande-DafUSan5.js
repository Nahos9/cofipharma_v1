import{r as l,j as e,a as S,J as F,f as h}from"./app-w6a547Vb.js";import"./Dropdown-CP2V3e5L.js";import{a as M,c as n}from"./index-co7Wh1Ok.js";import{C as R}from"./CaissiereLayout-Ce7LDckx.js";import{D as g}from"./download-8dMC1r2x.js";import{C as u}from"./check-CpY3E6HU.js";import{O as f,I as E}from"./octagon-x-7aXUWCgK.js";import{F as $}from"./file-text-BOxOGzHZ.js";import"./transition-BVKY275e.js";import"./createLucideIcon-B8UbJd7i.js";const P=({demande:t})=>{const[j,d]=l.useState(!1),[p,o]=l.useState(!1),[i,c]=l.useState(null),[r,m]=l.useState(null),N=s=>{switch(s){case"en attente":return"bg-yellow-100 text-yellow-800";case"accepte":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=s=>{switch(s){case"en attente":return"En attente";case"accepte":return"Approuvé";case"rejected":return"Rejeté";default:return s}},b=s=>{c(s),d(!0)},w=s=>{m(s),o(!0)},v=()=>{i&&h.post(route("demandes.validateOrReject",i.id),{_method:"PUT",status:"accepte"},{onSuccess:()=>{d(!1),c(null),n.success("La demande a été validée avec succès",{duration:4e3,position:"top-right",style:{background:"#10B981",color:"#fff"}})},onError:s=>{s.status===419?window.location.href=route("login"):n.error("Une erreur est survenue lors de la validation",{duration:4e3,position:"top-right",style:{background:"#EF4444",color:"#fff"}})}})},_=()=>{r&&h.post(route("demandes.validateOrReject",r.id),{_method:"PUT",status:"rejete"},{onSuccess:()=>{o(!1),m(null),n.success("La demande a été rejetée avec succès",{duration:4e3,position:"top-right",style:{background:"#EF4444",color:"#fff"}})},onError:s=>{s.status===419?window.location.href=route("login"):n.error("Une erreur est survenue lors du rejet",{duration:4e3,position:"top-right",style:{background:"#EF4444",color:"#fff"}})}})},k=s=>s.startsWith("image/")?e.jsx(E,{className:"h-6 w-6 text-blue-500"}):e.jsx($,{className:"h-6 w-6 text-blue-500"}),C=s=>{if(s===0)return"0 Bytes";const a=1024,D=["Bytes","KB","MB","GB"],x=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,x)).toFixed(2))+" "+D[x]};return e.jsxs(R,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:["Détails de la demande # ",t.first_name,"  ",t.last_name]}),e.jsxs("div",{className:"flex space-x-4",children:[t.status=="en attente"&&t.user_validateur_level=="charge client"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>b(t),className:"text-green-600 hover:text-green-900",title:"Debloquer",children:e.jsx(u,{size:35})}),e.jsx("button",{onClick:()=>w(t),className:"text-red-600 hover:text-red-900",title:"Rejeter",children:e.jsx(f,{size:35})})]}),e.jsx(F,{href:route("caissiere.demandes.all"),className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Retour à la liste"})]})]}),children:[e.jsx(S,{title:`Détails de la demande #${t.id}`}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Informations générales"}),e.jsxs("dl",{className:"mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"N° demande"}),e.jsx("dd",{className:"mt-1 text-3xl font-semibold text-gray-900",children:t.id})]}),e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Statut"}),e.jsx("dd",{className:"mt-1",children:e.jsx("span",{className:`inline-flex rounded-full px-2 text-xs font-semibold leading-5 ${N(t.status)}`,children:y(t.status)})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Informations du demandeur"}),e.jsxs("dl",{className:"mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Nom"}),e.jsx("dd",{className:"mt-1 text-xl font-semibold text-gray-900",children:t.first_name})]}),e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Email"}),e.jsx("dd",{className:"mt-1  font-semibold text-gray-900",children:t.email})]})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Détails de la demande"}),e.jsxs("div",{className:"mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Montant demande"}),e.jsxs("dd",{className:"mt-1 text-lg text-gray-900",children:[t.montant," FCFA"]})]}),e.jsxs("div",{className:"overflow-hidden rounded-lg mt-1 bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Numéro de commande"}),e.jsx("dd",{className:"mt-1 text-lg text-gray-900",children:t.numero_compte})]})]}),e.jsxs("div",{className:"mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"text-sm font-semibold text-gray-500",children:"Mode de paiement"}),e.jsx("dd",{className:"mt-1 text-xl font-semibold text-gray-900 whitespace-pre-wrap",children:t.mode_paiement})]}),t.mode_paiement=="mobile"&&e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"text-sm font-semibold text-gray-500",children:"Numéro de téléphone"}),e.jsx("dd",{className:"mt-1 text-xl font-semibold text-gray-900",children:t.phone})]}),t.mode_paiement=="carte"&&e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"text-sm font-semibold text-gray-500",children:"Numéro de carte"}),e.jsx("dd",{className:"mt-1 text-lg font-semibold text-gray-900",children:t.numero_carte})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Dates"}),e.jsxs("dl",{className:"mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Date de création"}),e.jsx("dd",{className:"mt-1 text-lg text-gray-900",children:new Date(t.created_at).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[e.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Dernière modification"}),e.jsx("dd",{className:"mt-1 text-lg text-gray-900",children:new Date(t.updated_at).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Contrat signé"}),e.jsx("div",{className:"mt-5",children:t.piece_jointes&&t.piece_jointes.filter(s=>(s.chemin_fichier||"").startsWith(`contrats_signes/${t.id}/`)||s.is_signed).length>0?e.jsx("ul",{className:"space-y-2",children:t.piece_jointes.filter(s=>(s.chemin_fichier||"").startsWith(`contrats_signes/${t.id}/`)||s.is_signed).map(s=>{const a=(s.chemin_fichier||"").startsWith("http")?s.chemin_fichier:`/storage/${s.chemin_fichier}`;return e.jsxs("li",{className:"flex items-center gap-3 bg-gray-50 rounded p-3",children:[e.jsx("span",{className:"truncate flex-1",children:s.nom_fichier}),e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:"Visualiser"}),e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",download:!0,className:"inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[e.jsx(g,{className:"h-4 w-4 mr-1"})," Télécharger"]})]},s.id)})}):e.jsx("div",{className:"text-gray-500",children:"Aucun contrat signé"})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Autres pièces jointes"}),e.jsx("div",{className:"mt-5",children:t.piece_jointes&&t.piece_jointes.filter(s=>!((s.chemin_fichier||"").startsWith(`contrats_signes/${t.id}/`)||s.is_signed)).length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:t.piece_jointes.filter(s=>!((s.chemin_fichier||"").startsWith(`contrats_signes/${t.id}/`)||s.is_signed)).map(s=>e.jsxs("div",{className:"relative flex items-center space-x-3 rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm hover:border-gray-400",children:[e.jsx("div",{className:"flex-shrink-0",children:k(s.type_mime)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.nom_fichier}),e.jsx("p",{className:"text-sm text-gray-500",children:C(s.taille_fichier)})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("a",{href:(s.chemin_fichier||"").startsWith("http")?s.chemin_fichier:`/storage/${s.chemin_fichier}`,download:s.nom_fichier,className:"inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[e.jsx(g,{className:"h-4 w-4 mr-1"}),"Télécharger"]})})]},s.id))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"Aucune pièce jointe disponible"})})})]})]})})})}),e.jsx(M,{}),j&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:align-middle",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(u,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Confirmer la validation"}),e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Êtes-vous sûr de vouloir valider la demande de ",i==null?void 0:i.first_name," ",i==null?void 0:i.last_name," ? Cette action est irréversible."]})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[e.jsx("button",{type:"button",onClick:v,className:"inline-flex w-full justify-center rounded-md border border-transparent bg-green-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",children:"Valider"}),e.jsx("button",{type:"button",onClick:()=>{d(!1),c(null)},className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Annuler"})]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:align-middle",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(f,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Confirmer le rejet"}),e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Êtes-vous sûr de vouloir rejeter la demande de ",r==null?void 0:r.first_name," ",r==null?void 0:r.last_name," ? Cette action est irréversible."]})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[e.jsx("button",{type:"button",onClick:_,className:"inline-flex w-full justify-center rounded-md border border-transparent bg-red-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",children:"Rejeter"}),e.jsx("button",{type:"button",onClick:()=>{o(!1),m(null)},className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Annuler"})]})]})]})})]})};export{P as default};
