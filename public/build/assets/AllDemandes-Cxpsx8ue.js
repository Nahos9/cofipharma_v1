import{r as i,f as x,j as e,a as S}from"./app-w6a547Vb.js";import"./Dropdown-CP2V3e5L.js";import{a as k,V as d}from"./index-co7Wh1Ok.js";import{V as C}from"./VisiteurLayout-FpVtoTE2.js";import{T as E}from"./trash-Du9-TJAU.js";import{E as R}from"./eye-CgALKQB6.js";import"./transition-BVKY275e.js";import"./createLucideIcon-B8UbJd7i.js";const T=({demandes:s})=>{const[n,u]=i.useState([]),[f,m]=i.useState(!1),[l,j]=i.useState(""),[c,v]=i.useState(""),[y,p]=i.useState(!1),[a,h]=i.useState(null);console.log(s.data);const g=i.useMemo(()=>s.data.filter(t=>{const r=l===""||t.first_name&&t.first_name.toLowerCase().includes(l.toLowerCase())||t.last_name&&t.last_name.toLowerCase().includes(l.toLowerCase())||t.email&&t.email.toLowerCase().includes(l.toLowerCase())||t.montant&&t.montant.toString().includes(l)||t.type&&t.type.toLowerCase().includes(l.toLowerCase()),o=c===""||t.status===c;return r&&o}),[s.data,l,c]),b=t=>{const r=t.target.checked;m(r),u(r?g.map(o=>o.id):[])},w=t=>{u(r=>r.includes(t)?r.filter(o=>o!==t):[...r,t])};x.on("error",t=>{t.status===419&&(window.location.href=route("login"))});const N=()=>{confirm("Êtes-vous sûr de vouloir supprimer les demandes sélectionnées ?")&&x.post(route("demandes.delete-multiple"),{ids:n,is_deleted:!0},{onSuccess:()=>{u([]),m(!1),d.success("Les demandes ont été supprimées avec succès",{duration:4e3,position:"top-right",style:{background:"#10B981",color:"#fff"}})},onError:t=>{t.status===419?window.location.href=route("login"):d.error("Une erreur est survenue lors de la suppression",{duration:4e3,position:"top-right",style:{background:"#EF4444",color:"#fff"}})}})},_=()=>{a&&x.post(route("demandes.destroy",a.id),{_method:"PUT",is_deleted:!0},{onSuccess:()=>{p(!1),h(null),d.success("La demande a été supprimée avec succès",{duration:4e3,position:"top-right",style:{background:"#10B981",color:"#fff"}})},onError:t=>{t.status===419?window.location.href=route("login"):d.error("Une erreur est survenue lors de la suppression",{duration:4e3,position:"top-right",style:{background:"#EF4444",color:"#fff"}})}})};return e.jsxs(C,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Gestion des demandes"}),n.length>0&&e.jsxs("button",{onClick:N,className:"rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white hover:bg-red-500",children:["Supprimer (",n.length,")"]})]}),children:[e.jsx(S,{title:"Gestion des demandes"}),e.jsx(k,{}),y&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:align-middle",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(E,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Confirmer la suppression"}),e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Êtes-vous sûr de vouloir supprimer la demande de ",a==null?void 0:a.first_name," ",a==null?void 0:a.last_name," ? Cette action est irréversible."]})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[e.jsx("button",{type:"button",onClick:_,className:"inline-flex w-full justify-center rounded-md border border-transparent bg-red-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",children:"Supprimer"}),e.jsx("button",{type:"button",onClick:()=>{p(!1),h(null)},className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Annuler"})]})]})]})}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"search",className:"sr-only",children:"Rechercher"}),e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("input",{type:"text",name:"search",id:"search",value:l,onChange:t=>j(t.target.value),className:"block w-full rounded-md border-gray-300 pr-10 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Rechercher par nom, email, montant..."}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"sr-only",children:"Statut"}),e.jsxs("select",{id:"status",name:"status",value:c,onChange:t=>v(t.target.value),className:"block w-full rounded-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"en attente",children:"En attente"}),e.jsx("option",{value:"accepte",children:"Approuvé"}),e.jsx("option",{value:"rejete",children:"Rejeté"}),e.jsx("option",{value:"debloque",children:"Débloqué"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"relative w-12 px-6 sm:w-16 sm:px-8",children:e.jsx("input",{type:"checkbox",className:"absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600",checked:f,onChange:b})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"N°"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Nom du demandeur"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Téléphone"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Montant"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Statut"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Date de demande"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:g.map(t=>e.jsxs("tr",{className:n.includes(t.id)?"bg-gray-50":"",children:[e.jsx("td",{className:"relative w-12 px-6 sm:w-16 sm:px-8",children:e.jsx("input",{type:"checkbox",className:"absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600",checked:n.includes(t.id),onChange:()=>w(t.id)})}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:t.id}),e.jsxs("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:t.email}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:t==null?void 0:t.phone}),e.jsxs("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:[t.montant," FCFA"]}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-flex rounded-full px-2 text-xs font-semibold leading-5 ${t.status==="en attente"?"bg-yellow-100 text-yellow-800":t.status==="accepte"&&t.user_validateur_level==="responsable_ritel"||t.status==="accepte"&&t.user_validateur_level==="operation"?"bg-green-100 text-green-800":t.status==="debloque"?"bg-purple-100 text-purple-800":t.status==="rejete"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:(()=>{if(t.status==="en attente"){if(t.user_validateur_level==="responsable_ritel")return"En attente (responsable Ritel)";if(t.user_validateur_level==="charge client")return"En attente (Charge client)"}if(t.status==="accepte"){if(t.user_validateur_level==="responsable_ritel")return"En attente (responsable Ritel)";if(t.user_validateur_level==="charge client")return"En attente (Charge client)"}if(t.status==="accepte"){if(t.user_validateur_level==="responsable_ritel")return"En attente (responsable ritel)";if(t.user_validateur_level==="operation")return"En attente (Operation)"}return t.status==="debloque"?"Débloqué":t.status==="rejete"?t.user_validateur_level==="operation"?"Rejeté par Opération":t.user_validateur_level==="responsable_ritel"?"Rejeté par Ritel":t.user_validateur_level==="charge client"?"Rejeté (charge client)":"Rejeté":"Statut inconnu"})()})}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString("fr-FR")}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-right text-sm font-medium flex gap-1 items-center",children:e.jsx("a",{href:route("visiteur.demandes.edit",t.id),className:"text-indigo-600 hover:text-indigo-900",title:"details",children:e.jsx(R,{})})})]},t.id))})]})}),s.links.length>3&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[s.prev_page_url&&e.jsx("a",{href:s.prev_page_url,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Précédent"}),s.next_page_url&&e.jsx("a",{href:s.next_page_url,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Suivant"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Affichage de ",e.jsx("span",{className:"font-medium",children:s.from})," à"," ",e.jsx("span",{className:"font-medium",children:s.to})," sur"," ",e.jsx("span",{className:"font-medium",children:s.total})," résultats"]})}),e.jsx("div",{children:e.jsx("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:s.links.map((t,r)=>e.jsx("a",{href:t.url,className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${t.active?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,dangerouslySetInnerHTML:{__html:t.label}},r))})})]})]})]})})})})]})};export{T as default};
