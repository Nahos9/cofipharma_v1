import{S as B,r as c,f as $,j as e,a as W}from"./app-B0hzU4lX.js";import{y as f,N as G,L as J,F as q}from"./FooterHome-CiaRNQoA.js";import{I as l}from"./InputLabel-DMuBGzbQ.js";import{T as o}from"./TextInput-BTzXwt7Z.js";import{I as m}from"./InputError-CrsYErYK.js";import{P as X}from"./PrimaryButton-CaKL8CK3.js";import{r as K}from"./docx-preview-Beq5M-JY.js";import"./button-BDA1yoaQ.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-DuupygLo.js";import"./x-BlPni_fV.js";import"./mail-D1jdY9aq.js";import"./phone-BiO0MbTw.js";const de=({auth:g,flash:u})=>{const{data:s,setData:a,post:U,processing:y,errors:d,reset:E}=B({numero_compte:"",phone:"",email:"",nom:"",prenom:"",status:"",montant:"",fichiers:[],civility:"",address:"",city:"",bp:"",piece_identite:"",numero_piece_identite:"",date_naissance:"",lieu_naissance:"",nationalite:"",profession:"",employeur:"",date_de_delivrance_piece_identite:"",mode_paiement:"",carte:""}),[n,w]=c.useState(1),[A,L]=c.useState(""),[C,M]=c.useState(!1),[b,k]=c.useState(""),[_,F]=c.useState(""),[p,S]=c.useState(""),[h,P]=c.useState(""),[V,v]=c.useState(!1),j=c.useRef(null),[D,T]=c.useState("");c.useEffect(()=>{u.success&&(f.success(u.success,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,className:"bg-green-500 text-white",bodyClassName:"font-bold"}),E(),setTimeout(()=>{$.visit(route("welcome"))},1500)),u.error&&f.error(u.error)},[u]);const I=n===1?25:n===2?50:n===3?75:100,R=()=>s.nom&&s.prenom&&s.email&&s.phone&&s.numero_compte&&s.montant,H=t=>{if(t.preventDefault(),n===1&&!R()){f.error("Veuillez compléter les champs obligatoires de l'étape 1");return}n!==4&&w(r=>Math.min(4,r+1))},O=t=>{t.preventDefault(),w(r=>Math.max(1,r-1))},z=t=>{if(t.preventDefault(),!C){f.error("Vous devez accepter les conditions avant de soumettre.");return}U(route("av_salaire.store"))};return c.useEffect(()=>{if(n!==3)return;T("");const t=new URLSearchParams({first_name:s.prenom||"",last_name:s.nom||"",email:s.email||"",numero_compte:s.numero_compte||"",montant:s.montant||"",phone:s.phone||"",mode_paiement:"",bp:s.bp||"",employeur:s.employeur||"",civility:s.civility||"",address:s.address||"",city:s.city||"",piece_identite:s.piece_identite||"",numero_piece_identite:s.numero_piece_identite||"",date_de_delivrance_piece_identite:s.date_de_delivrance_piece_identite||"",date_naissance:s.date_naissance||"",lieu_naissance:s.lieu_naissance||"",nationalite:s.nationalite||"",profession:s.profession||""}),r=route("av_salaire.contracts.previewDocx")+`?${t.toString()}`;fetch(r,{credentials:"include"}).then(async i=>{const x=await i.json().catch(()=>null);if(!i.ok){const N=x&&(x.error||x.message)||"Preview contrat indisponible";throw new Error(N)}return x}).then(i=>{k(i.officeViewUrl||i.office_view_url||""),F(i.googleViewUrl||i.google_view_url||""),S(i.docxUrl||i.docx_url||""),P(i.docxRelativeUrl||i.docx_relative_url||""),v(!1)}).catch(i=>{T((i==null?void 0:i.message)||"Preview contrat indisponible"),k(""),F(""),S(""),P(""),v(!0)})},[n,s]),c.useEffect(()=>{(async()=>{if(n===3&&!(!h&&!p)&&j.current)try{const i=await fetch(h||p,{credentials:"same-origin"});if(!i.ok)throw new Error("Docx non accessible");const N=await(await i.blob()).arrayBuffer();j.current.innerHTML="",await K(N,j.current,void 0,{className:"docx-view",inWrapper:!0,ignoreWidth:!1,ignoreHeight:!1}),v(!1)}catch{v(!0)}})()},[n,p,h]),e.jsxs("div",{children:[e.jsx(G,{user:g==null?void 0:g.user}),e.jsx(W,{title:"demande avance "}),e.jsx(J,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsxs("div",{className:"mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Demande d'Avance sur Salaire"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${I}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-2",children:[e.jsx("span",{children:"Étape 1: Formulaire"}),e.jsx("span",{children:"Étape 2: Récapitulatif"}),e.jsx("span",{children:"Étape 3: Contrat"}),e.jsx("span",{children:"Étape 4: Acceptation"})]})]}),e.jsxs("form",{onSubmit:n===4?z:H,className:"border p-2 shadow-lg",children:[n===1&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(l,{htmlFor:"civility",value:"Civilité"}),e.jsxs("select",{id:"civility",value:s.civility,onChange:t=>a("civility",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Sélectionnez"}),e.jsx("option",{value:"mr",children:"Mr"}),e.jsx("option",{value:"mme",children:"Mme"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"nom",value:"Votre nom"}),e.jsx(o,{id:"nom",type:"text",name:"nom",value:s.nom,className:"mt-1 block w-full",onChange:t=>a("nom",t.target.value)}),e.jsx(m,{message:d.nom,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"prenom",value:"Votre prénom"}),e.jsx(o,{id:"prenom",type:"text",name:"prenom",value:s.prenom,className:"mt-1 block w-full",onChange:t=>a("prenom",t.target.value)}),e.jsx(m,{message:d.prenom,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"email",value:"Votre email"}),e.jsx(o,{id:"email",type:"text",name:"email",value:s.email,className:"mt-1 block w-full",onChange:t=>a("email",t.target.value)}),e.jsx(m,{message:d.email,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"phone",value:"Numéro de téléphone"}),e.jsx(o,{id:"phone",type:"text",name:"phone",value:s.phone,className:"mt-1 block w-full",onChange:t=>a("phone",t.target.value)}),e.jsx(m,{message:d.phone,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"numero_compte",value:"Numéro de compte courant"}),e.jsx(o,{id:"numero_compte",type:"text",name:"numero_compte",value:s.numero_compte,className:"mt-1 block w-full",inputMode:"numeric",pattern:"^371.*",onInvalid:t=>t.currentTarget.setCustomValidity("Le numéro de compte doit commencer par 371"),onInput:t=>t.currentTarget.setCustomValidity(""),onChange:t=>{const r=t.target.value;r&&!r.startsWith("371")?t.target.setCustomValidity("Le numéro de compte doit commencer par 371"):t.target.setCustomValidity(""),a(i=>({...i,numero_compte:r}))}}),e.jsx(m,{message:d.numero_compte,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"montant",value:"Montant"}),e.jsx(o,{id:"montant",type:"text",name:"montant",value:s.montant,className:"mt-1 block w-full",onChange:t=>a("montant",t.target.value)}),e.jsx(m,{message:d.montant,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"address",value:"Adresse"}),e.jsx(o,{id:"address",type:"text",name:"address",value:s.address,className:"mt-1 block w-full",onChange:t=>a("address",t.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"city",value:"Ville"}),e.jsx(o,{id:"city",type:"text",name:"city",value:s.city,className:"mt-1 block w-full",onChange:t=>a("city",t.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"bp",value:"BP"}),e.jsx(o,{id:"bp",type:"text",name:"bp",value:s.bp,className:"mt-1 block w-full",onChange:t=>a("bp",t.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"profession",value:"profession"}),e.jsx(o,{id:"profession",type:"text",name:"profession",value:s.profession,className:"mt-1 block w-full",onChange:t=>a("profession",t.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"employeur",value:"Employeur"}),e.jsx(o,{id:"employeur",type:"text",name:"employeur",value:s.employeur,className:"mt-1 block w-full",onChange:t=>a("employeur",t.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"piece_identite",value:"Pièce d'identité"}),e.jsxs("select",{id:"piece_identite",value:s.piece_identite,onChange:t=>a("piece_identite",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Sélectionnez"}),e.jsx("option",{value:"cni",children:"Carte nationale d'identité"}),e.jsx("option",{value:"passport",children:"Passeport"}),e.jsx("option",{value:"permis de conduire",children:"Permis de conduire"}),e.jsx("option",{value:"cart_sej",children:"Carte de séjour"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"numero_piece_identite",value:"Numéro de la pièce"}),e.jsx(o,{id:"numero_piece_identite",type:"text",name:"numero_piece_identite",value:s.numero_piece_identite,className:"mt-1 block w-full",onChange:t=>a("numero_piece_identite",t.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"date_de_delivrance_piece_identite",value:"Date de délivrance de la pièce"}),e.jsx(o,{id:"date_de_delivrance_piece_identite",type:"date",name:"date_de_delivrance_piece_identite",value:s.date_de_delivrance_piece_identite,className:"mt-1 block w-full",onChange:t=>a("date_de_delivrance_piece_identite",t.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"date_naissance",value:"Date de naissance"}),e.jsx(o,{id:"date_naissance",type:"date",name:"date_naissance",value:s.date_naissance,className:"mt-1 block w-full",onChange:t=>a("date_naissance",t.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"lieu_naissance",value:"Lieu de naissance"}),e.jsx(o,{id:"lieu_naissance",type:"text",name:"lieu_naissance",value:s.lieu_naissance,className:"mt-1 block w-full",onChange:t=>a("lieu_naissance",t.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"nationalite",value:"Nationalité"}),e.jsx(o,{id:"nationalite",type:"text",name:"nationalite",value:s.nationalite,className:"mt-1 block w-full",onChange:t=>a("nationalite",t.target.value)})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"montant",children:"Mode de paiement (*)"}),e.jsxs("select",{className:`shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${d.montant?"border-red-500":""}`,value:s.mode_paiement,onChange:t=>a(r=>({...r,mode_paiement:t.target.value})),children:[e.jsx("option",{value:"",children:"Sélectionnez"}),e.jsx("option",{value:"caisse",children:"Caisse"}),e.jsx("option",{value:"mobile",children:"Mobile monaie"}),e.jsx("option",{value:"carte",children:"Carte prépayée"})]})]}),s.mode_paiement=="mobile"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"telephone",children:"Numéro de téléphone (*)"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"telephone",type:"tel",placeholder:"Votre numéro de téléphone",onChange:t=>{a(r=>({...r,phone:t.target.value}))},value:s.phone})]}),s.mode_paiement=="carte"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"carte",children:"Numéro de la carte (*)"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"carte",type:"text",placeholder:"Numéro de la carte",onChange:t=>{a(r=>({...r,carte:t.target.value}))},value:s.carte})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx(l,{htmlFor:"fichiers",value:"Joindre des fichiers (*)"}),e.jsx("input",{id:"fichiers",type:"file",name:"fichiers",multiple:!0,className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",onChange:t=>a("fichiers",t.target.files)}),e.jsx(m,{message:d.fichiers,className:"mt-2"})]})]}),n===2&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Récapitulatif"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nom:"})," ",s.nom]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Prénom:"})," ",s.prenom]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Téléphone:"})," ",s.phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Numéro de compte:"})," ",s.numero_compte]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Montant:"})," ",s.montant]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Adresse:"})," ",s.address]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ville:"})," ",s.city]}),e.jsxs("div",{children:[e.jsx("strong",{children:"BP:"})," ",s.bp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Employeur:"})," ",s.employeur]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Pièce:"})," ",s.piece_identite]}),e.jsxs("div",{children:[e.jsx("strong",{children:"N° Pièce:"})," ",s.numero_piece_identite]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date délivrance:"})," ",s.date_de_delivrance_piece_identite]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date naissance:"})," ",s.date_naissance]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Lieu naissance:"})," ",s.lieu_naissance]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Nationalité:"})," ",s.nationalite]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Profession:"})," ",s.profession]})]})]}),n===3&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Contrat"}),e.jsx("div",{className:"bg-gray-50 rounded border border-gray-200 p-2",children:e.jsxs("div",{className:"relative w-full",style:{minHeight:"40vh"},children:[!V&&e.jsx("div",{ref:j,className:"docx-container w-full h-full overflow-auto",style:{maxHeight:"70vh"}}),V&&(b||_)&&e.jsx("div",{className:"w-full",style:{height:"70vh"},children:e.jsx("iframe",{title:"Aperçu du contrat",src:b||_,style:{width:"100%",height:"100%",border:0},allow:"fullscreen"})}),!p&&!h&&!b&&!_&&e.jsxs("div",{className:"text-gray-600 space-y-2",children:[e.jsx("div",{children:"Génération de l'aperçu du contrat en cours ou indisponible."}),D&&e.jsx("div",{className:"text-red-600",children:D}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Astuces:",e.jsxs("ul",{className:"list-disc ml-5",children:[e.jsx("li",{children:"Vérifiez que vous êtes connecté."}),e.jsxs("li",{children:["Ajoutez un modèle DOCX dans ",e.jsx("code",{children:"resources/contracts/Contrat.docx"})," ou ",e.jsx("code",{children:"resources/contracts/contrat.docx"}),"."]})]})]})]})]})})]}),n===4&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Acceptation"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Mention manuscrite (taper la mention)"}),e.jsx("textarea",{value:A,onChange:t=>L(t.target.value),className:"w-full border rounded-md p-2",rows:3,placeholder:"Lu et approuvé..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"acceptTerms",type:"checkbox",checked:C,onChange:t=>M(t.target.checked)}),e.jsx("label",{htmlFor:"acceptTerms",children:"J'ai lu et j'accepte les termes du contrat"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx("button",{type:"button",className:`px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-gray-800 ${n===1?"opacity-50 cursor-not-allowed":""}`,onClick:O,disabled:n===1,children:"Étape précédente"}),e.jsx(X,{disabled:y,children:y?"Traitement...":n===4?"Soumettre la demande":"Continuer"})]})]})]}),e.jsx(q,{})]})};export{de as default};
