import{S as R,r as c,f as z,j as e,a as H}from"./app-IlUcRzel.js";import{y as x,N as O,L as B,F as $}from"./FooterHome-6wuPE2OA.js";import{I as i}from"./InputLabel-Bq-Wrxjw.js";import{T as o}from"./TextInput-COl3EhQS.js";import{I as m}from"./InputError-BxTYyW4i.js";import{P as J}from"./PrimaryButton-C_cIauDY.js";import{r as W}from"./docx-preview-BcgneXgT.js";import"./button-T2iQtihg.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-CeHlE1ZC.js";import"./x-BcWCZmoZ.js";import"./mail-WRGFpPmI.js";import"./phone-Dnu-lJeB.js";const de=({auth:g,flash:u})=>{const{data:t,setData:a,post:T,processing:y,errors:d,reset:U}=R({numero_compte:"",phone:"",email:"",nom:"",prenom:"",status:"",montant:"",fichiers:[],civility:"",address:"",city:"",bp:"",piece_identite:"",numero_piece_identite:"",date_naissance:"",lieu_naissance:"",nationalite:"",profession:"",employeur:"",date_de_delivrance_piece_identite:"",mode_paiement:"",carte:"",mention_text:"",mention_accepted:!1,mention_accepted_at:""}),[l,w]=c.useState(1),[G,q]=c.useState(""),[X,K]=c.useState(!1),[_,C]=c.useState(""),[b,k]=c.useState(""),[h,F]=c.useState(""),[v,S]=c.useState(""),[P,j]=c.useState(!1),f=c.useRef(null),[V,D]=c.useState("");c.useEffect(()=>{u.success&&(x.success(u.success,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,className:"bg-green-500 text-white",bodyClassName:"font-bold"}),U(),setTimeout(()=>{z.visit(route("welcome"))},1500)),u.error&&x.error(u.error)},[u]);const E=l===1?25:l===2?50:l===3?75:100,L=()=>t.nom&&t.prenom&&t.email&&t.phone&&t.numero_compte&&t.montant,A=s=>{if(s.preventDefault(),l===1&&!L()){x.error("Veuillez compléter les champs obligatoires de l'étape 1");return}l!==4&&w(r=>Math.min(4,r+1))},M=s=>{s.preventDefault(),w(r=>Math.max(1,r-1))},I=s=>{if(s.preventDefault(),!t.mention_accepted){x.error("Vous devez accepter les conditions avant de soumettre.");return}if((t.mention_text||"").trim().toLowerCase()!=="j’ai lu et approuvé"&&(t.mention_text||"").trim().toLowerCase()!=="j'ai lu et approuvé"){x.error("Veuillez saisir exactement: 'J’ai lu et approuvé'.");return}T(route("av_salaire.store"))};return c.useEffect(()=>{if(l!==3)return;D("");const s=new URLSearchParams({first_name:t.prenom||"",last_name:t.nom||"",email:t.email||"",numero_compte:t.numero_compte||"",montant:t.montant||"",phone:t.phone||"",mode_paiement:"",mention_text:t.mention_text||"",mention_accepted:t.mention_accepted||!1,mention_accepted_at:t.mention_accepted_at||"",bp:t.bp||"",employeur:t.employeur||"",civility:t.civility||"",address:t.address||"",city:t.city||"",piece_identite:t.piece_identite||"",numero_piece_identite:t.numero_piece_identite||"",date_de_delivrance_piece_identite:t.date_de_delivrance_piece_identite||"",date_naissance:t.date_naissance||"",lieu_naissance:t.lieu_naissance||"",nationalite:t.nationalite||"",profession:t.profession||"",mention_text:t.mention_text||"",mention_accepted:t.mention_accepted||!1,mention_accepted_at:t.mention_accepted_at||""}),r=route("av_salaire.contracts.previewDocx")+`?${s.toString()}`;fetch(r,{credentials:"include"}).then(async n=>{const p=await n.json().catch(()=>null);if(!n.ok){const N=p&&(p.error||p.message)||"Preview contrat indisponible";throw new Error(N)}return p}).then(n=>{C(n.officeViewUrl||n.office_view_url||""),k(n.googleViewUrl||n.google_view_url||""),F(n.docxUrl||n.docx_url||""),S(n.docxRelativeUrl||n.docx_relative_url||""),j(!1)}).catch(n=>{D((n==null?void 0:n.message)||"Preview contrat indisponible"),C(""),k(""),F(""),S(""),j(!0)})},[l,t]),c.useEffect(()=>{(async()=>{if(l===3&&!(!v&&!h)&&f.current)try{const n=await fetch(v||h,{credentials:"same-origin"});if(!n.ok)throw new Error("Docx non accessible");const N=await(await n.blob()).arrayBuffer();f.current.innerHTML="",await W(N,f.current,void 0,{className:"docx-view",inWrapper:!0,ignoreWidth:!1,ignoreHeight:!1}),j(!1)}catch{j(!0)}})()},[l,h,v]),e.jsxs("div",{children:[e.jsx(O,{user:g==null?void 0:g.user}),e.jsx(H,{title:"demande avance "}),e.jsx(B,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsxs("div",{className:"mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Demande d'Avance sur Salaire"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${E}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-2",children:[e.jsx("span",{children:"Étape 1: Formulaire"}),e.jsx("span",{children:"Étape 2: Récapitulatif"}),e.jsx("span",{children:"Étape 3: Contrat"}),e.jsx("span",{children:"Étape 4: Acceptation"})]})]}),e.jsxs("form",{onSubmit:l===4?I:A,className:"border p-2 shadow-lg",children:[l===1&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(i,{htmlFor:"civility",value:"Civilité"}),e.jsxs("select",{id:"civility",value:t.civility,onChange:s=>a("civility",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Sélectionnez"}),e.jsx("option",{value:"mr",children:"Mr"}),e.jsx("option",{value:"mme",children:"Mme"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"nom",value:"Votre nom"}),e.jsx(o,{id:"nom",type:"text",name:"nom",value:t.nom,className:"mt-1 block w-full",onChange:s=>a("nom",s.target.value)}),e.jsx(m,{message:d.nom,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"prenom",value:"Votre prénom"}),e.jsx(o,{id:"prenom",type:"text",name:"prenom",value:t.prenom,className:"mt-1 block w-full",onChange:s=>a("prenom",s.target.value)}),e.jsx(m,{message:d.prenom,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"email",value:"Votre email"}),e.jsx(o,{id:"email",type:"text",name:"email",value:t.email,className:"mt-1 block w-full",onChange:s=>a("email",s.target.value)}),e.jsx(m,{message:d.email,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"phone",value:"Numéro de téléphone"}),e.jsx(o,{id:"phone",type:"text",name:"phone",value:t.phone,className:"mt-1 block w-full",onChange:s=>a("phone",s.target.value)}),e.jsx(m,{message:d.phone,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"numero_compte",value:"Numéro de compte courant"}),e.jsx(o,{id:"numero_compte",type:"text",name:"numero_compte",value:t.numero_compte,className:"mt-1 block w-full",inputMode:"numeric",pattern:"^371.*",onInvalid:s=>s.currentTarget.setCustomValidity("Le numéro de compte doit commencer par 371"),onInput:s=>s.currentTarget.setCustomValidity(""),onChange:s=>{const r=s.target.value;r&&!r.startsWith("371")?s.target.setCustomValidity("Le numéro de compte doit commencer par 371"):s.target.setCustomValidity(""),a(n=>({...n,numero_compte:r}))}}),e.jsx(m,{message:d.numero_compte,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"montant",value:"Montant"}),e.jsx(o,{id:"montant",type:"text",name:"montant",value:t.montant,className:"mt-1 block w-full",onChange:s=>a("montant",s.target.value)}),e.jsx(m,{message:d.montant,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"address",value:"Adresse"}),e.jsx(o,{id:"address",type:"text",name:"address",value:t.address,className:"mt-1 block w-full",onChange:s=>a("address",s.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"city",value:"Ville"}),e.jsx(o,{id:"city",type:"text",name:"city",value:t.city,className:"mt-1 block w-full",onChange:s=>a("city",s.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"bp",value:"BP"}),e.jsx(o,{id:"bp",type:"text",name:"bp",value:t.bp,className:"mt-1 block w-full",onChange:s=>a("bp",s.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"profession",value:"profession"}),e.jsx(o,{id:"profession",type:"text",name:"profession",value:t.profession,className:"mt-1 block w-full",onChange:s=>a("profession",s.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"employeur",value:"Employeur"}),e.jsx(o,{id:"employeur",type:"text",name:"employeur",value:t.employeur,className:"mt-1 block w-full",onChange:s=>a("employeur",s.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"piece_identite",value:"Pièce d'identité"}),e.jsxs("select",{id:"piece_identite",value:t.piece_identite,onChange:s=>a("piece_identite",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Sélectionnez"}),e.jsx("option",{value:"cni",children:"Carte nationale d'identité"}),e.jsx("option",{value:"passport",children:"Passeport"}),e.jsx("option",{value:"permis de conduire",children:"Permis de conduire"}),e.jsx("option",{value:"cart_sej",children:"Carte de séjour"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"numero_piece_identite",value:"Numéro de la pièce"}),e.jsx(o,{id:"numero_piece_identite",type:"text",name:"numero_piece_identite",value:t.numero_piece_identite,className:"mt-1 block w-full",onChange:s=>a("numero_piece_identite",s.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"date_de_delivrance_piece_identite",value:"Date de délivrance de la pièce"}),e.jsx(o,{id:"date_de_delivrance_piece_identite",type:"date",name:"date_de_delivrance_piece_identite",value:t.date_de_delivrance_piece_identite,className:"mt-1 block w-full",onChange:s=>a("date_de_delivrance_piece_identite",s.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"date_naissance",value:"Date de naissance"}),e.jsx(o,{id:"date_naissance",type:"date",name:"date_naissance",value:t.date_naissance,className:"mt-1 block w-full",onChange:s=>a("date_naissance",s.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"lieu_naissance",value:"Lieu de naissance"}),e.jsx(o,{id:"lieu_naissance",type:"text",name:"lieu_naissance",value:t.lieu_naissance,className:"mt-1 block w-full",onChange:s=>a("lieu_naissance",s.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"nationalite",value:"Nationalité"}),e.jsx(o,{id:"nationalite",type:"text",name:"nationalite",value:t.nationalite,className:"mt-1 block w-full",onChange:s=>a("nationalite",s.target.value)})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"montant",children:"Mode de paiement (*)"}),e.jsxs("select",{className:`shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${d.montant?"border-red-500":""}`,value:t.mode_paiement,onChange:s=>a(r=>({...r,mode_paiement:s.target.value})),children:[e.jsx("option",{value:"",children:"Sélectionnez"}),e.jsx("option",{value:"caisse",children:"Caisse"}),e.jsx("option",{value:"mobile",children:"Mobile monaie"}),e.jsx("option",{value:"carte",children:"Carte prépayée"})]})]}),t.mode_paiement=="mobile"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"telephone",children:"Numéro de téléphone (*)"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"telephone",type:"tel",placeholder:"Votre numéro de téléphone",onChange:s=>{a(r=>({...r,phone:s.target.value}))},value:t.phone})]}),t.mode_paiement=="carte"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"carte",children:"Numéro de la carte (*)"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"carte",type:"text",placeholder:"Numéro de la carte",onChange:s=>{a(r=>({...r,carte:s.target.value}))},value:t.carte})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx(i,{htmlFor:"fichiers",value:"Joindre des fichiers (*)"}),e.jsx("input",{id:"fichiers",type:"file",name:"fichiers",multiple:!0,className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",onChange:s=>a("fichiers",s.target.files)}),e.jsx(m,{message:d.fichiers,className:"mt-2"})]})]}),l===2&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Récapitulatif"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nom:"})," ",t.nom]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Prénom:"})," ",t.prenom]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Téléphone:"})," ",t.phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Numéro de compte:"})," ",t.numero_compte]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Montant:"})," ",t.montant]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Adresse:"})," ",t.address]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ville:"})," ",t.city]}),e.jsxs("div",{children:[e.jsx("strong",{children:"BP:"})," ",t.bp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Employeur:"})," ",t.employeur]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Pièce:"})," ",t.piece_identite]}),e.jsxs("div",{children:[e.jsx("strong",{children:"N° Pièce:"})," ",t.numero_piece_identite]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date délivrance:"})," ",t.date_de_delivrance_piece_identite]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date naissance:"})," ",t.date_naissance]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Lieu naissance:"})," ",t.lieu_naissance]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Nationalité:"})," ",t.nationalite]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Profession:"})," ",t.profession]})]})]}),l===3&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Contrat"}),e.jsx("div",{className:"bg-gray-50 rounded border border-gray-200 p-2",children:e.jsxs("div",{className:"relative w-full",style:{minHeight:"40vh"},children:[!P&&e.jsx("div",{ref:f,className:"docx-container w-full h-full overflow-auto",style:{maxHeight:"70vh"}}),P&&(_||b)&&e.jsx("div",{className:"w-full",style:{height:"70vh"},children:e.jsx("iframe",{title:"Aperçu du contrat",src:_||b,style:{width:"100%",height:"100%",border:0},allow:"fullscreen"})}),!h&&!v&&!_&&!b&&e.jsxs("div",{className:"text-gray-600 space-y-2",children:[e.jsx("div",{children:"Génération de l'aperçu du contrat en cours ou indisponible."}),V&&e.jsx("div",{className:"text-red-600",children:V}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Astuces:",e.jsxs("ul",{className:"list-disc ml-5",children:[e.jsx("li",{children:"Vérifiez que vous êtes connecté."}),e.jsxs("li",{children:["Ajoutez un modèle DOCX dans ",e.jsx("code",{children:"resources/contracts/Contrat.docx"})," ou ",e.jsx("code",{children:"resources/contracts/contrat.docx"}),"."]})]})]})]})]})})]}),l===4&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Acceptation"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Mention manuscrite (taper la mention)"}),e.jsx("textarea",{value:t.mention_text,onChange:s=>a("mention_text",s.target.value),className:"w-full border rounded-md p-2",rows:3,placeholder:"Lu et approuvé..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"acceptTerms",type:"checkbox",checked:t.mention_accepted,onChange:s=>a("mention_accepted",s.target.checked)}),e.jsx("label",{htmlFor:"acceptTerms",children:"J'ai lu et j'accepte les termes du contrat"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx("button",{type:"button",className:`px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-gray-800 ${l===1?"opacity-50 cursor-not-allowed":""}`,onClick:M,disabled:l===1,children:"Étape précédente"}),e.jsx(J,{disabled:y,children:y?"Traitement...":l===4?"Soumettre la demande":"Continuer"})]})]})]}),e.jsx($,{})]})};export{de as default};
